<div class="form-card">
    <div class="form-card__body">
        <div class="form-field">
            <label for="date_debut" class="form-label">Choisir une date de début :</label>
            <input type="date" class="form-input" id="date_debut">
        </div>

        <div class="form-field">
            <label for="date_fin" class="form-label">Choisir une date de fin :</label>
            <input type="date" class="form-input" id="date_fin">
        </div>

        <div class="form-field">
            <span class="form-label">Familles à inclure :</span>
            <div class="form-checklist">
                {% set familles = [
                    { value: 'Cathinones', label: 'Cathinones' },
                    { value: 'MDMA', label: 'MDMA' },
                    { value: 'Cocaïne', label: 'Cocaïne' },
                    { value: 'Héroïne', label: 'Héroïne' },
                    { value: 'Kétamine', label: 'Kétamine' },
                    { value: 'Speed', label: 'Speed' },
                    { value: 'Dissociatifs', label: 'Dissociatifs' },
                    { value: 'Amphétamines', label: 'Amphétamines' },
                    { value: 'Opioïdes', label: 'Opioïdes' },
                    { value: 'Cannabinoïdes', label: 'Cannabinoïdes' },
                    { value: 'Hallucinogènes', label: 'Hallucinogènes' },
                    { value: 'Crack/Freebase (cocaine base)', label: 'Crack/Freebase (cocaine base)' },
                    { value: 'Benzodiazépines_et_similaires', label: 'Benzodiazépines et similaires' },
                    { value: 'GABAergiques_non_benzo', label: 'GABAergiques non benzo' }
                ] %}
                {% for famille in familles %}
                    <label class="form-checkbox">
                        <input type="checkbox" name="famille" value="{{ famille.value }}">
                        <span>{{ famille.label }}</span>
                    </label>
                {% endfor %}
            </div>
            <p class="form-note">Laissez vide pour inclure toutes les familles.</p>
        </div>

        <button id="sendButton" class="btn btn--primary btn--block" type="button">Appliquer</button>
    </div>
</div>

<script>
document.getElementById('sendButton').addEventListener('click', function () {
    const date_debut = document.getElementById('date_debut').value;
    const date_fin = document.getElementById('date_fin').value;
    const selectedFamilles = Array.from(document.querySelectorAll('input[name="famille"]:checked')).map(cb => cb.value);

    const params = new URLSearchParams();
    if (date_debut) params.set('date_debut', date_debut);
    if (date_fin) params.set('date_fin', date_fin);
    if (selectedFamilles.length > 0) params.set('familles', selectedFamilles.join(','));

    window.location = window.location.pathname + '?' + params.toString();
});
</script>
