<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Analyses statistiques d√©taill√©es sur la consommation de drogue en France : puret√©, coupe, tendances et comparaisons r√©gionales.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/patternomaly@1.3.0/dist/patternomaly.min.js"></script>

    {% block javascripts %}
        {{ encore_entry_script_tags('chart-defaults', attributes={ defer: false }) }}
        {{ encore_entry_script_tags('app') }}
    {% endblock %}
 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

</head>
{% set _supported_themes = ['navy', 'nocturne', 'neon'] %}
{% set _theme = app.request.query.get('theme') %}
{% if _theme not in _supported_themes %}
    {% set _theme = 'navy' %}
{% endif %}
{% set _embed_molecule_slug = molecule is defined ? molecule.slug : null %}
<body
    data-theme="{{ _theme }}"
    data-embed-route="{{ path('app_embedded') }}"
    {% if _embed_molecule_slug %}
        data-embed-molecule="{{ _embed_molecule_slug }}"
    {% endif %}
>
  
    {% include "nav.html.twig" %}

    <main id="content">
        {% block body %}{% endblock %}
    </main>

    {% include 'footer.html.twig' %}

    <div class="card-modal" data-card-modal aria-hidden="true">
        <div class="card-modal__backdrop" data-card-modal-close></div>
        <div class="card-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="cardModalTitle" tabindex="-1">
            <header class="card-modal__header">
                <div class="card-modal__header-text">
                    <h2 id="cardModalTitle" class="card-modal__title" data-card-modal-title>Visualisation</h2>
                </div>
                <button class="card-modal__close" type="button" aria-label="Fermer la fen√™tre" data-card-modal-close>‚úï</button>
            </header>
            <div class="card-modal__body">
                <div class="card-modal__content" data-card-modal-content></div>
                <aside class="card-modal__sidebar">
                    <section class="card-modal__section card-modal__section--description">
                        <p class="card-modal__section-label">Description</p>
                        <div class="card-modal__section-content" data-card-modal-description>
                            <p class="card-modal__muted">Aucune description disponible.</p>
                        </div>
                    </section>
                    <section class="card-modal__section card-modal__section--tools">
                        <p class="card-modal__section-label">Outils</p>
                        <div class="card-modal__tools" data-card-modal-tools>
                            <button
                                type="button"
                                class="card-modal__tool card-modal__tool--share"
                                data-card-modal-share-button
                                disabled
                            >
                                <span class="card-modal__tool-icon" aria-hidden="true">üîó</span>
                                <span class="card-modal__tool-content">
                                    <span class="card-modal__tool-title">Partager le graphique</span>
                                    <span class="card-modal__tool-desc">Copier le lien direct vers cette vue.</span>
                                </span>
                                <span class="card-modal__tool-status" data-tool-status>Copier</span>
                            </button>
                            <button
                                type="button"
                                class="card-modal__tool card-modal__tool--iframe"
                                data-card-modal-share-iframe-button
                                disabled
                            >
                                <span class="card-modal__tool-icon" aria-hidden="true">üß©</span>
                                <span class="card-modal__tool-content">
                                    <span class="card-modal__tool-title">Partager via iframe</span>
                                    <span class="card-modal__tool-desc">G√©n√®re le code d‚Äôint√©gration.</span>
                                </span>
                                <span class="card-modal__tool-status" data-tool-status>Copier</span>
                            </button>
                            <button
                                type="button"
                                class="card-modal__tool card-modal__tool--export"
                                data-card-modal-export-button
                                disabled
                            >
                                <span class="card-modal__tool-icon" aria-hidden="true">‚¨áÔ∏è</span>
                                <span class="card-modal__tool-content">
                                    <span class="card-modal__tool-title">Exporter les donn√©es</span>
                                    <span class="card-modal__tool-desc">T√©l√©charger le tableau au format CSV.</span>
                                </span>
                                <span class="card-modal__tool-status">T√©l√©charger</span>
                            </button>
                        </div>
                    </section>
                </aside>
            </div>
        </div>
    </div>
    <script>
        (function() {
            const storageKey = 'psychotopia-theme';
            const readStoredTheme = () => {
                try {
                    return window.localStorage.getItem(storageKey);
                } catch (error) {
                    return null;
                }
            };
            const persistTheme = (theme) => {
                try {
                    window.localStorage.setItem(storageKey, theme);
                } catch (error) {
                    /* ignore persistence errors */
                }
            };
            const supportedThemes = {{ _supported_themes|json_encode|raw }};
            const body = document.body;
            const savedTheme = readStoredTheme();

            if (savedTheme && supportedThemes.includes(savedTheme)) {
                body.dataset.theme = savedTheme;
            }

            const updatePickers = () => {
                const activeTheme = body.dataset.theme || 'navy';
                document.querySelectorAll('[data-theme-picker]').forEach((picker) => {
                    picker.value = activeTheme;
                });
            };

            const applyTheme = (theme) => {
                if (!supportedThemes.includes(theme)) {
                    return;
                }
                body.dataset.theme = theme;
                persistTheme(theme);
                updatePickers();
            };

            document.addEventListener('change', (event) => {
                const target = event.target;
                if (!(target instanceof HTMLSelectElement)) {
                    return;
                }
                if (!target.matches('[data-theme-picker]')) {
                    return;
                }
                applyTheme(target.value);
            });

            updatePickers();
        })();
    </script>
</body>
</html>
