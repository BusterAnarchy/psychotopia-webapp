{% extends 'base.html.twig' %}

{% block title %} Coupe - {{ molecule.label }} {% endblock %}
{% block centerText %} Coupe - {{ molecule.label }} {% endblock %}

{% block body %}
<div class="analysis-page">
    {% include "components/molecule_nav.html.twig" with { molecule: molecule } %}
    <header class="analysis-header container">
        <div class="analysis-header__meta analysis-header__card">
            <small class="analysis-header__label">Nombre total d'échantillons observés :</small>
            <p class="analysis-header__count">{{ results.count }}</p>
        </div>
        <article class="analysis-header__info analysis-header__card">
            <p>{{ molecule.definition | raw }}</p>
            {% if molecule.wikiUrl %}
                <p>
                    Pour plus d'informations, vous pouvez consulter la
                    <a href="{{ molecule.wikiUrl }}" target="_blank" rel="noreferrer">page Wiki de cette substance</a>.
                </p>
            {% endif %}
        </article>
    </header>

    <aside
        id="drawerFilters"
        class="drawer"
        role="dialog"
        aria-modal="true"
        aria-labelledby="drawerFiltersTitle"
        aria-hidden="true"
    >
        <div class="drawer__panel">
            <div class="drawer__handle" aria-hidden="true"></div>
            <div class="drawer__inner">
                <div class="drawer__header">
                    <h3 id="drawerFiltersTitle">Options de visualisation</h3>
                    <button class="btn btn--ghost drawer__close" type="button" aria-label="Fermer les options" data-drawer-close>✕</button>
                </div>
                <div class="drawer__body">
                    {% include "components/form_coupe.html.twig" %}
                </div>
            </div>
        </div>
    </aside>

    {% include "components/drawer_trigger.html.twig" %}

    <section class="info-panel container">
        <p>
            "Les produits de coupe sont des substances ajoutées au principe actif d’un produit stupéfiant,
            au cours de son parcours allant de sa production à sa consommation par l’usager final, afin
            d’augmenter le poids total du produit à la revente et éventuellement en raison de l’action pharmacologique de la ou des substances ajoutées."
            (Définition de l'OFDT)
        </p>
    </section>

    <section class="analysis-grid container">
        <article class="analysis-card">
            <header class="analysis-card__head">Proportion des échantillons avec produits de coupe</header>
            <div class="analysis-card__body">
                {% include "components/pie_chart.html.twig" with { id:"pie_chart", chart_data: results.count_cut_agents | json_encode } %}
                <p class="analysis-card__desc">
                    Le diagramme présente la proportion d'échantillons contenant un ou plusieurs produits de coupe.
                </p>
            </div>
        </article>

        <article class="analysis-card">
            <header class="analysis-card__head">Proportion par produit de coupe</header>
            <div class="analysis-card__body">
                {% include "components/bar_x_chart.html.twig" with { id:"bar_chart", chart_data: results.histo_cut_agents | json_encode } %}
                <p class="analysis-card__desc">
                    Parmi les échantillons contenant un ou plusieurs produits de coupe, voici la proportion pour chacun d'eux.
                </p>
            </div>
        </article>

        <article class="analysis-card">
            <header class="analysis-card__head">Évolution temporelle des produits de coupe</header>
            <div class="analysis-card__body">
                {% include "components/area_stacked_chart.html.twig" with { id:"area_chart", chart_data: results.temporal_cut_agents | json_encode, is_stacked:'false', mode:'relatif' } %}
                <p class="analysis-card__desc">
                    Parmi les échantillons coupés, voici l'évolution temporelle (par bimestre) de la présence de chaque produit de coupe.
                </p>
            </div>
        </article>
    </section>
</div>
{% endblock %}
