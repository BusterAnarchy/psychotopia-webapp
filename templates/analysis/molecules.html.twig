{# templates/molecules.html.twig - refonte sans Bootstrap (mobile-first) #}
{% extends 'base.html.twig' %}

{% block title %} {{ page_title }} {% endblock %}
{% block centerText %} {{ page_title }} {% endblock %}

{% block body %}
<div class="analysis-page">
  <header class="analysis-header container">
    <div class="analysis-header__meta">
      <small class="analysis-header__label">Nombre total d'échantillons observés :</small>
      <p class="analysis-header__count">{{ results.count }}</p>
    </div>

  </header>

  <aside
    id="drawerFilters"
    class="drawer"
    role="dialog"
    aria-modal="true"
    aria-labelledby="drawerFiltersTitle"
    aria-hidden="true"
  >
    <div class="drawer__panel">
      <div class="drawer__handle" aria-hidden="true"></div>
      <div class="drawer__inner">
        <div class="drawer__header">
          <h3 id="drawerFiltersTitle">Options de visualisation</h3>
          <button class="btn btn--ghost drawer__close" type="button" aria-label="Fermer les options" data-drawer-close>✕</button>
        </div>

        <div class="drawer__body">
          {% include "components/form.html.twig" %}
        </div>
      </div>
    </div>
  </aside>

  {% include "components/drawer_trigger.html.twig" %}

  <section class="analysis-grid container" id="moleculesMain">
    <article class="analysis-card">
      <header class="analysis-card__head">Répartition par molécule</header>
      <div class="analysis-card__body">
        {% include "components/pie_chart.html.twig" with { id:"pie_chart", chart_data: results.histo_count | json_encode } %}
        <p class="analysis-card__desc">Le diagramme présente la proportion des échantillons en fonction de la molécule supposée.</p>
      </div>
    </article>

    <article class="analysis-card">
      <header class="analysis-card__head">Proportion après première consommation</header>
      <div class="analysis-card__body">
        {% include "components/pie_chart.html.twig" with { id:"pie_chart_conso", chart_data:results.pie_consumption | json_encode } %}
        <p class="analysis-card__desc">Proportion des échantillons envoyés après une première consommation.</p>
      </div>
    </article>

    <article class="analysis-card">
      <header class="analysis-card__head">Évolution temporelle — Nombre d'échantillons</header>
      <div class="analysis-card__body">
        {% include "components/area_stacked_chart.html.twig" with { id:"area_chart_1", chart_data:results.temporal_count_abs | json_encode, is_stacked:'true', mode:'absolu' } %}
        <p class="analysis-card__desc">Les données sont regroupées par bimestre et montrent l'évolution en nombre d'échantillons par molécule.</p>
      </div>
    </article>

    <article class="analysis-card">
      <header class="analysis-card__head">Évolution temporelle — Proportion</header>
      <div class="analysis-card__body">
        {% include "components/area_stacked_chart.html.twig" with { id:"area_chart_2", chart_data:results.temporal_count_prop | json_encode, is_stacked:'true', mode:'relatif' } %}
        <p class="analysis-card__desc">Les données sont regroupées par bimestre et montrent l'évolution en proportion d'échantillons par molécule.</p>
      </div>
    </article>

    <article class="analysis-card">
      <header class="analysis-card__head">Carte — Nombre d'échantillons par région</header>
      <div class="analysis-card__body">
        {{ render_map('map_chart_abs', results.geo_count_abs, options:{
            'start_hsl': [120, 60, 85],
            'end_hsl': [200, 100, 30],
        }) }}
        <p class="analysis-card__desc">La carte montre le nombre d'échantillons reçus en fonction de la région d'envoi.</p>
      </div>
    </article>

    <article class="analysis-card">
      <header class="analysis-card__head">Carte — Échantillons par million d'habitants</header>
      <div class="analysis-card__body">
        {{ render_map('map_chart_prop', results.geo_count_prop, options:{
            'start_hsl': [50, 100, 70],
            'end_hsl': [0, 100, 40],
        } ) }}
        <p class="analysis-card__desc">Nombre d'échantillons reçus par région, rapporté à la population (par million d'habitants).</p>
      </div>
    </article>
  </section>
</div>
{% endblock %}
