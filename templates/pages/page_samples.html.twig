{# templates/samples.html.twig - refonte sans Bootstrap (mobile-first) #}
{% extends 'base.html.twig' %}

{% block title %} {{ page_title }} {% endblock %}
{% block centerText %} {{ page_title }} {% endblock %}

{% block body %}
<div class="analysis-page">
  <header class="analysis-header container">
    <div class="analysis-header__meta analysis-header__card">
      <small class="analysis-header__label">Nombre total d'échantillons observés :</small>
      <p class="analysis-header__count">{{ results.count }}</p>
      {% include "components/ui/filter/filter_summary.html.twig" with { summary: filters_summary|default([]) } %}
    </div>

  </header>

  {% include "components/ui/filter/filter_drawer.html.twig" with { form_template: "components/forms/form_molecules.html.twig" } %}
  {% include "components/ui/filter/filter_drawer_trigger.html.twig" %}

  {% include "components/ui/grid_layout_controls.html.twig" %}

  <section class="analysis-grid container" id="moleculesMain">
    {% include "components/ui/analysis_card.html.twig" with {
      embed_chart: 'samples_distribution',
      
      title: "Répartition par molécule",
      description: "Le diagramme présente la proportion des échantillons en fonction de la molécule supposée.",
      
      body_template: "components/charts/chart_pie.html.twig",
      body_context: { id:"pie_chart", chart_data: results.histo_count | json_encode }
    } %}

    {% include "components/ui/analysis_card.html.twig" with {
      embed_chart: 'samples_first_consumption',

      title: "Proportion après première consommation",
      description: "Proportion des échantillons envoyés après une première consommation.",

      body_template: "components/charts/chart_pie.html.twig",
      body_context: { id:"pie_chart_conso", chart_data: results.pie_consumption | json_encode }
    } %}

    {% include "components/ui/analysis_card.html.twig" with {
      embed_chart: 'samples_timeline_absolute',
      
      title: "Évolution temporelle — Nombre d'échantillons",
      description: "Les données sont regroupées par bimestre et montrent l'évolution en nombre d'échantillons par molécule.",
      
      body_template: "components/charts/chart_area_stacked.html.twig",
      body_context: { id:"area_chart_1", chart_data: results.temporal_count_abs | json_encode, is_stacked:'true', mode:'absolu' }
    } %}

    {% include "components/ui/analysis_card.html.twig" with {
      embed_chart: 'samples_timeline_relative',
      
      title: "Évolution temporelle — Proportion",
      description: "Les données sont regroupées par bimestre et montrent l'évolution en proportion d'échantillons par molécule.",
      
      body_template: "components/charts/chart_area_stacked.html.twig",
      body_context: { id:"area_chart_2", chart_data: results.temporal_count_prop | json_encode, is_stacked:'true', mode:'relatif' }
    } %}

    {% include "components/ui/analysis_card.html.twig" with {
      embed_chart: 'samples_map_absolute',
      
      title: "Carte — Nombre d'échantillons par région",
      description:  "La carte montre le nombre d'échantillons reçus en fonction de la région d'envoi.",
      
      body_content: render_map('map_chart_abs', results.geo_count_abs, options:{
        'start_hsl': [120, 60, 85],
        'end_hsl': [200, 100, 30],
      })
    } %}

    {% include "components/ui/analysis_card.html.twig" with {
      embed_chart: 'samples_map_relative',
      
      title: "Carte — Échantillons par million d'habitants",
      description:  "Nombre d'échantillons reçus par région, rapporté à la population (par million d'habitants).",
      
      body_content: render_map('map_chart_prop', results.geo_count_prop, options:{
        'start_hsl': [50, 100, 70],
        'end_hsl': [0, 100, 40],
      })
    } %}
  </section>
</div>
{% endblock %}
