{% extends 'base.html.twig' %}

{% block title %} Coupe - {{ molecule.label }} {% endblock %}
{% block centerText %} Coupe - {{ molecule.label }} {% endblock %}

{% block body %}
<div class="analysis-page">

    {% include "components/ui/molecule_nav.html.twig" with { molecule: molecule } %}
    {% include "components/ui/molecule_header.html.twig" %}
 
    {% include "components/ui/filter/filter_drawer.html.twig" with { form_template: "components/forms/form_cut.html.twig"} %}
    {% include "components/ui/filter/filter_drawer_trigger.html.twig" %}

    <section class="info-panel container">
        <p>
            "Les produits de coupe sont des substances ajoutées au principe actif d’un produit stupéfiant,
            au cours de son parcours allant de sa production à sa consommation par l’usager final, afin
            d’augmenter le poids total du produit à la revente et éventuellement en raison de l’action pharmacologique de la ou des substances ajoutées."
            (Définition de l'OFDT)
        </p>
    </section>

    {% include "components/ui/grid_layout_controls.html.twig" %}

    <section class="analysis-grid container">
        {% include "components/ui/analysis_card.html.twig" with {
            embed_chart: 'cut_agents_share',

            title: "Proportion des échantillons avec produits de coupe",
            description: "Le diagramme présente la proportion d'échantillons contenant un ou plusieurs produits de coupe.",

            body_template: "components/charts/chart_pie.html.twig",
            body_context: { id:"pie_chart", chart_data: results.count_cut_agents | json_encode }
        } %}

        {% include "components/ui/analysis_card.html.twig" with {
            embed_chart: 'cut_agents_distribution',

            title: "Proportion par produit de coupe",
            description: "Parmi les échantillons contenant un ou plusieurs produits de coupe, voici la proportion pour chacun d'eux.",
            
            body_template: "components/charts/chart_bar_x.html.twig",
            body_context: { id:"bar_chart", chart_data: results.histo_cut_agents | json_encode }
        } %}

        {% include "components/ui/analysis_card.html.twig" with {
            embed_chart: 'cut_agents_timeline',
            
            title: "Évolution temporelle des produits de coupe",
            description: "Parmi les échantillons coupés, voici l'évolution temporelle (par bimestre) de la présence de chaque produit de coupe.",
            
            body_template: "components/charts/chart_area_stacked.html.twig",
            body_context: { id:"area_chart", chart_data: results.temporal_cut_agents | json_encode, is_stacked:'false', mode:'relatif' }
        } %}
    </section>
</div>
{% endblock %}
